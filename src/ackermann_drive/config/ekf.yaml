ekf_filter_node:
  ros__parameters:
    use_sim_time: false

    # ------------------ General EKF settings ------------------
    frequency: 50.0
    sensor_timeout: 0.1

    two_d_mode: true

    publish_tf: true
    publish_acceleration: false

    map_frame: map
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom


    # ------------------ Wheel Odometry ------------------
    # Main source of planar motion
    odom0: /wheel/odom
    odom0_queue_size: 10
    odom0_differential: false
    odom0_relative: false

    odom0_config:
      [false,  false,  false,
       false, false, false,
       true,  true,  false,
       false, false, true,
       false, false, false]


    # ------------------ IMU (MPU-9250) ------------------
    # Fuse ONLY gyroscope angular velocity
    # Do NOT fuse yaw or acceleration (both drift badly on MPU9250)
    imu0: /imu/data_raw
    imu0_queue_size: 10
    imu0_differential: false
    imu0_relative: false
    imu0_remove_gravitational_acceleration: true

    imu0_config:
      [false, false, false,
       false, false, false,
       false, false, false,
       false,  false,  true,
       true, false, false ]


    # ------------------ Process Noise ------------------
    # States:
    # x y z roll pitch yaw vx vy vz vroll vpitch vyaw ax ay az

    process_noise_covariance:

      [ 0.05, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.05, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.001,  0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,   0.001,0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.001,0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.25,  0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.03,0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.03,0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.001, 0.0, 0.0, 0.0,   0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.01,0.0, 0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.01,0.0,   0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.15,  0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.05,0.0, 0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.05,0.0,
        0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.0,   0.0, 0.0, 0.05 ]


    # ------------------ Initial Covariance ------------------
    # Very confident starting estimate

    initial_estimate_covariance:

      [ 1e-9, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 1e-9, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 1e-9,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,  1e-9,0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 1e-9,0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 1e-9,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  1e-9,0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 1e-9,0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 1e-9,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  1e-9,0.0, 0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 1e-9,0.0,  0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 1e-9,  0.0, 0.0, 0.0,

        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  1e-9,0.0, 0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 1e-9,0.0,
        0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 0.0,  0.0, 0.0, 1e-9 ]
